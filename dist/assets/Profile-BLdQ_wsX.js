import{j as e}from"./ui-DVskvsiq.js";import{r as c}from"./vendor-CwEH9sB7.js";import{L as k}from"./router-BLvl1Ppa.js";import{C as y,b as _,c as b,a as w}from"./card-ZgMDuFeg.js";import{c as C,u as U,B as g,A as D,g as F,h as I,I as u,U as L}from"./index-BbNJ4jdd.js";import{A as M,a as T,L as n,H as X,P as z}from"./alert-BS373tjM.js";import{m as H}from"./motion-BLCFqyc1.js";import{A as R}from"./arrow-left-DmvLF2cp.js";import{M as B}from"./mail-DWgzyyaJ.js";import{G as V}from"./graduation-cap-Dfg9pyok.js";import"./query-DZlroNgi.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q=C("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=C("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);function se(){const{user:t,profile:a,updateProfile:P,refreshProfile:p}=U(),[m,j]=c.useState(!1),[v,o]=c.useState(!1),[N,l]=c.useState(null),[r,h]=c.useState({full_name:a?.full_name||"",phone:a?.phone||"",department:a?.department||"",student_id:a?.student_id||""});c.useEffect(()=>{t&&(console.log("Profile page mounted, refreshing profile for user:",t.id),console.log("Current profile state:",a),p())},[t?.id]),c.useEffect(()=>{if(a){console.log("Profile updated in Profile page:",a),console.log("Profile data to display:",{full_name:a.full_name,phone:a.phone,department:a.department,student_id:a.student_id});const s={full_name:a.full_name||"",phone:a.phone||"",department:a.department||"",student_id:a.student_id||""};console.log("Updating form data with profile values:",s),h(s)}else t?(console.log("User exists but profile is null, attempting to fetch..."),p()):(console.log("No profile and no user, resetting form data"),h({full_name:"",phone:"",department:"",student_id:""}))},[a,t,p]);const x=s=>{const{name:i,value:f}=s.target;h(d=>({...d,[i]:f}))},S=async()=>{o(!0),l(null);try{console.log("=== SAVE PROFILE START ==="),console.log("Saving profile data:",r),console.log("Current user:",t?.id),console.log("Current profile:",a);let s=!1;const i=setTimeout(()=>{s=!0,console.error("Save operation timed out after 30 seconds"),l({type:"error",text:"Save operation timed out. Please check your connection and try again. If the problem persists, check the browser console for details."}),o(!1)},3e4);console.log("Calling updateProfile..."),console.log("Form data being sent:",r),console.log("User ID:",t?.id),console.log("User email:",t?.email);const{data:{session:f}}=await supabase.auth.getSession();if(console.log("Current session:",f?"Exists":"None"),!f){l({type:"error",text:"No active session. Please log in again."}),o(!1),clearTimeout(i);return}const{error:d}=await P(r);if(clearTimeout(i),s){console.warn("Timeout fired, ignoring result");return}console.log("updateProfile completed, error:",d),d?(console.error("Profile update error:",d),l({type:"error",text:d.message||"Failed to update profile. Please check the browser console for details."}),o(!1)):(console.log("Profile updated successfully!"),l({type:"success",text:"Profile updated successfully! Your changes have been saved permanently."}),j(!1),o(!1),setTimeout(async()=>{console.log("Refreshing profile after save..."),await p()},300))}catch(s){console.error("Profile update exception:",s),l({type:"error",text:s?.message||"An unexpected error occurred. Please check the browser console."}),o(!1)}},A=()=>{h({full_name:a?.full_name||"",phone:a?.phone||"",department:a?.department||"",student_id:a?.student_id||""}),j(!1),l(null)},E=s=>s.split(" ").map(i=>i.charAt(0)).join("").toUpperCase().slice(0,2);return e.jsxs(H.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"max-w-2xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx(k,{to:"/dashboard",children:e.jsxs(g,{variant:"outline",size:"sm",className:"gap-2",children:[e.jsx(R,{className:"h-4 w-4"}),"Back to Dashboard"]})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Profile Settings"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage your account information and preferences"})]})]}),N&&e.jsx(M,{variant:N.type==="error"?"destructive":"default",children:e.jsx(T,{children:N.text})}),e.jsxs(y,{children:[e.jsx(_,{children:e.jsx(b,{className:"text-xl",children:"Profile Picture"})}),e.jsx(w,{children:e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsx("div",{className:"relative",children:e.jsxs(D,{className:"h-24 w-24",children:[e.jsx(F,{src:a?.avatar_url||void 0}),e.jsx(I,{className:"bg-primary text-primary-foreground text-xl",children:a?.full_name?E(a.full_name):t?.email?.split("@")[0]?.charAt(0).toUpperCase()||"U"})]})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-foreground text-lg",children:a?.full_name||t?.email?.split("@")[0]||"No name set"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:t?.email}),a?.department&&e.jsxs("p",{className:"text-xs text-muted-foreground mb-1",children:[a.department," ",a.student_id&&`â€¢ ID: ${a.student_id}`]}),!a?.full_name&&e.jsx("p",{className:"text-xs text-primary/80 mb-2 italic",children:"Complete your profile below to see your name here"})]})]})})]}),e.jsxs(y,{children:[e.jsx(_,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(b,{className:"text-xl",children:"Personal Information"}),m?e.jsxs("div",{className:"flex gap-2",children:[e.jsx(g,{variant:"outline",size:"sm",onClick:A,disabled:v,children:"Cancel"}),e.jsxs(g,{size:"sm",onClick:S,disabled:v,children:[v?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}):e.jsx(q,{className:"h-4 w-4 mr-2"}),"Save"]})]}):e.jsxs(g,{variant:"outline",size:"sm",onClick:()=>j(!0),children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),"Edit"]})]})}),e.jsxs(w,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"email",children:"Email Address"}),e.jsxs("div",{className:"relative",children:[e.jsx(B,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(u,{id:"email",type:"email",value:t?.email||"",disabled:!0,className:"pl-10 bg-muted"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Email address cannot be changed"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"full_name",children:"Full Name"}),e.jsxs("div",{className:"relative",children:[e.jsx(L,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(u,{id:"full_name",name:"full_name",type:"text",placeholder:"Your full name",value:r.full_name,onChange:x,disabled:!m,className:"pl-10"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"student_id",children:"Student ID"}),e.jsxs("div",{className:"relative",children:[e.jsx(X,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(u,{id:"student_id",name:"student_id",type:"text",placeholder:"22xxxxx",value:r.student_id,onChange:x,disabled:!m,className:"pl-10"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"department",children:"Department"}),e.jsxs("div",{className:"relative",children:[e.jsx(V,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(u,{id:"department",name:"department",type:"text",placeholder:"ME, EEE, CSE...",value:r.department,onChange:x,disabled:!m,className:"pl-10"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"phone",children:"Phone Number"}),e.jsxs("div",{className:"relative",children:[e.jsx(z,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(u,{id:"phone",name:"phone",type:"tel",placeholder:"+880 1XXXXXXXXX",value:r.phone,onChange:x,disabled:!m,className:"pl-10"})]})]})]})]}),e.jsxs(y,{children:[e.jsx(_,{children:e.jsx(b,{className:"text-xl",children:"Account Information"})}),e.jsx(w,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(n,{className:"text-sm font-medium",children:"Account Created"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:a?.created_at?new Date(a.created_at).toLocaleString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):t?.created_at?new Date(t.created_at).toLocaleString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A"})]}),e.jsxs("div",{children:[e.jsx(n,{className:"text-sm font-medium",children:"Last Updated"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:a?.updated_at?new Date(a.updated_at).toLocaleString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):a?.created_at?new Date(a.created_at).toLocaleString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A"})]})]})})]})]})}export{se as default};
